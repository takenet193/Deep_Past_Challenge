---
type: task
id: task-20260123140000
title: ドキュメントマネージャーのルール設定ファイル改定
author: takeikumi
status: active
priority: high
project: docs_refactor
mode: docs
context: []
dependencies:
  - task-20260123120000
  - task-20260123130000
related_notes:
  - task_refactor_20260123
assignee: null
assigned_agent: null
due_date: null
created: 2026-01-23
updated: 2026-01-23
tags:
  - docs
  - refactor
  - agent
  - rules
---

# タスク: ドキュメントマネージャーのルール設定ファイル改定

## 目的

ドキュメントリファクタリングプロジェクトで定めたルールを、Docs Manager（AIエージェント）が常に遵守するように、設定ファイル（`.cursor/docs_manager_rules.mdc`）を改定する。
エージェントがドキュメントを作成・編集する際に、自動的にルールをチェックし、遵守するようにする。

## 前提条件

- タスク `task-20260123120000`（ルール違反ドキュメントの列挙）が完了していること
- タスク `task-20260123130000`（ルール違反ドキュメントのリファクタリング実行）が完了していること
- ルールが明確に定義されていること

## 対象設定ファイル

- `.cursor/docs_manager_rules.mdc` - Docs Managerの運用ルール

## 追加すべきルール

### 1. ファイル行数制限

#### ルール
- **基準**: 300行以下（できれば150行以下）
- **チェック**: ファイル作成・編集時に必ず行数を確認
- **違反時の対応**: 
  - 300行を超える場合は、内容を論理的なまとまりごとに分割
  - 分割後は元のファイルをストラクチャーノート（目次・ハブノート）として再構成

#### 実装方針
- ファイル作成・編集時に自動的に行数をチェック
- 300行超の場合は警告を出し、分割を提案
- 分割が必要な場合は、ユーザー承認を得てから実行

### 2. マークダウン構造の見出しレベル制限

#### ルール
- **基準**: 見出し3レベル（###）まで
- **チェック**: ファイル作成・編集時に見出しレベルを確認
- **違反時の対応**: 
  - `####` 以降の見出しを使用している場合は、見出しレベルを `###` までに統合
  - 深い見出し構造が必要な場合は、内容を分割して別ファイルにする

#### 実装方針
- 見出しレベルを自動的にチェック
- `####` 以降の見出しを検出した場合は警告を出し、統合または分割を提案

### 3. リンク切れのチェック

#### ルール
- **基準**: 全てのリンクが有効であること
- **チェック**: ファイル作成・編集時にリンクを確認
- **違反時の対応**: 
  - リンク切れを検出した場合は、正しいパスに修正
  - リンク先が存在しない場合は、ユーザーに確認

#### 実装方針
- リンクを自動的に検証
- リンク切れを検出した場合は警告を出し、修正を提案

### 4. ファイル名と内容の一致

#### ルール
- **基準**: ファイル名が内容を正確に表していること
- **チェック**: ファイル作成・編集時に内容とファイル名の一致を確認
- **違反時の対応**: 
  - 不一致の場合は、内容に応じてファイルを分割またはリネーム

#### 実装方針
- ファイル名と内容の関連性をチェック
- 不一致の場合は警告を出し、分割またはリネームを提案

### 5. 内容重複・冗長な説明の削除

#### ルール
- **基準**: 同じ内容が複数箇所に記載されていないこと
- **チェック**: ファイル作成・編集時に重複を確認
- **違反時の対応**: 
  - 重複した内容を削除し、リンクで参照する形に変更
  - フォルダ構造の説明は各一回のみ（ページ内リンクで参照）
  - gitignore, json, templates, python コードの説明もリンクで参照
  - サンプルコードは `_samples.json` 等にまとめてリンクで参照

#### 実装方針
- 重複内容を自動的に検出（キーワードベース）
- 重複を検出した場合は警告を出し、リンク参照への変更を提案

### 6. リポジトリに含める/含めないの基準

#### ルール
- **基準**: 
  - **含める**: プロジェクトの構造や設計方針、作業手順、実験記録、基礎知識
  - **含めない**: 個人のメモ（references, structure や思想ノート等）
- **チェック**: ファイル作成・編集時に内容を確認
- **違反時の対応**: 
  - 個人メモがリポジトリに含まれている場合は、`.gitignore` に追加するか、別の場所に移動を提案

#### 実装方針
- ファイル内容を分析し、個人メモかどうかを判定
- 個人メモと判定された場合は警告を出し、適切な対応を提案

### 7. リンク表記の統一

#### ルール
- **基準**: リポジトリトップからの相対パス形式 `[title](./docs/title.md)` を推奨
- **チェック**: ファイル作成・編集時にリンク表記を確認
- **違反時の対応**: 
  - wiki リンク形式や不統一な表記を相対パス形式に変換
  - permanent_notes 内のリンクは同じ permanent_notes 内のみを参照

#### 実装方針
- リンク表記を自動的に統一
- wiki リンク形式を検出した場合は、相対パス形式に自動変換

### 8. 一行の長さ

#### ルール
- **基準**: 約100文字以下
- **チェック**: ファイル作成・編集時に一行の長さを確認
- **違反時の対応**: 
  - 100文字を超える行を適切に改行（コードブロック内は除く）

#### 実装方針
- 一行の長さを自動的にチェック
- 100文字を超える行を検出した場合は警告を出し、改行を提案

## 実装方針

### チェックタイミング

1. **ファイル作成時**: 新規ファイルを作成する際に、全てのルールをチェック
2. **ファイル編集時**: 既存ファイルを編集する際に、変更箇所に関連するルールをチェック
3. **定期チェック**: 週次レビュー時に、全ファイルをチェック

### チェック方法

1. **自動チェック**: ファイル作成・編集時に自動的にルールをチェック
2. **警告表示**: ルール違反を検出した場合は、警告を表示し、修正を提案
3. **自動修正**: 可能な範囲で自動的に修正（例: リンク表記の統一）
4. **ユーザー承認**: 分割やリネームなど、大きな変更が必要な場合は、ユーザー承認を得てから実行

### 設定ファイルへの追加方法

1. `.cursor/docs_manager_rules.mdc` に新しいセクション「ドキュメント品質ルール」を追加
2. 各ルールを明確に定義し、チェック方法と違反時の対応を記載
3. エージェントが必ず参照するように、優先度を最高に設定

## 手順

### フェーズ1: ルールの整理
- [ ] 追加すべきルールを整理
- [ ] 各ルールのチェック方法を決定
- [ ] 違反時の対応方法を決定

### フェーズ2: 設定ファイルの改定
- [ ] `.cursor/docs_manager_rules.mdc` を読み込む
- [ ] 新しいセクション「ドキュメント品質ルール」を追加
- [ ] 各ルールを明確に定義
- [ ] チェック方法と違反時の対応を記載
- [ ] エージェントが必ず参照するように、優先度を設定

### フェーズ3: チェック機能の実装（可能な範囲で）
- [ ] ファイル行数チェック機能を追加
- [ ] 見出しレベルチェック機能を追加
- [ ] リンク切れチェック機能を追加
- [ ] リンク表記統一機能を追加
- [ ] 一行の長さチェック機能を追加

### フェーズ4: テスト
- [ ] 設定ファイルを読み込んで、ルールが正しく定義されているか確認
- [ ] サンプルファイルでチェック機能をテスト
- [ ] 違反時の対応が正しく動作するか確認

### フェーズ5: ドキュメント化
- [ ] 設定ファイルの変更内容をドキュメント化
- [ ] エージェントがルールを遵守することを確認する方法を記載

## 設定ファイルへの追加内容（案）

### セクション: ドキュメント品質ルール

```markdown
## ドキュメント品質ルール（必須遵守）

Docs Managerは、ドキュメントを作成・編集する際に、以下のルールを**必ず遵守**すること。
これらのルールは、ドキュメントの検索性・可読性・保守性を保つために重要である。

### ルール1: ファイル行数制限

- **基準**: 300行以下（できれば150行以下）
- **チェック**: ファイル作成・編集時に必ず行数を確認
- **違反時の対応**: 
  - 300行を超える場合は、内容を論理的なまとまりごとに分割
  - 分割後は元のファイルをストラクチャーノート（目次・ハブノート）として再構成
  - 分割が必要な場合は、ユーザー承認を得てから実行

### ルール2: 見出しレベル制限

- **基準**: 見出し3レベル（###）まで
- **チェック**: ファイル作成・編集時に見出しレベルを確認
- **違反時の対応**: 
  - `####` 以降の見出しを使用している場合は、見出しレベルを `###` までに統合
  - 深い見出し構造が必要な場合は、内容を分割して別ファイルにする

### ルール3: リンク切れのチェック

- **基準**: 全てのリンクが有効であること
- **チェック**: ファイル作成・編集時にリンクを確認
- **違反時の対応**: 
  - リンク切れを検出した場合は、正しいパスに修正
  - リンク先が存在しない場合は、ユーザーに確認

### ルール4: ファイル名と内容の一致

- **基準**: ファイル名が内容を正確に表していること
- **チェック**: ファイル作成・編集時に内容とファイル名の一致を確認
- **違反時の対応**: 
  - 不一致の場合は、内容に応じてファイルを分割またはリネーム

### ルール5: 内容重複・冗長な説明の削除

- **基準**: 同じ内容が複数箇所に記載されていないこと
- **チェック**: ファイル作成・編集時に重複を確認
- **違反時の対応**: 
  - 重複した内容を削除し、リンクで参照する形に変更
  - フォルダ構造の説明は各一回のみ（ページ内リンクで参照）
  - gitignore, json, templates, python コードの説明もリンクで参照
  - サンプルコードは `_samples.json` 等にまとめてリンクで参照

### ルール6: リポジトリに含める/含めないの基準

- **基準**: 
  - **含める**: プロジェクトの構造や設計方針、作業手順、実験記録、基礎知識
  - **含めない**: 個人のメモ（references, structure や思想ノート等）
- **チェック**: ファイル作成・編集時に内容を確認
- **違反時の対応**: 
  - 個人メモがリポジトリに含まれている場合は、`.gitignore` に追加するか、別の場所に移動を提案

### ルール7: リンク表記の統一

- **基準**: リポジトリトップからの相対パス形式 `[title](./docs/title.md)` を推奨
- **チェック**: ファイル作成・編集時にリンク表記を確認
- **違反時の対応**: 
  - wiki リンク形式や不統一な表記を相対パス形式に自動変換
  - permanent_notes 内のリンクは同じ permanent_notes 内のみを参照

### ルール8: 一行の長さ

- **基準**: 約100文字以下
- **チェック**: ファイル作成・編集時に一行の長さを確認
- **違反時の対応**: 
  - 100文字を超える行を適切に改行（コードブロック内は除く）

### チェック実行タイミング

1. **ファイル作成時**: 新規ファイルを作成する際に、全てのルールをチェック
2. **ファイル編集時**: 既存ファイルを編集する際に、変更箇所に関連するルールをチェック
3. **定期チェック**: 週次レビュー時に、全ファイルをチェック

### チェック実行方法

1. **自動チェック**: ファイル作成・編集時に自動的にルールをチェック
2. **警告表示**: ルール違反を検出した場合は、警告を表示し、修正を提案
3. **自動修正**: 可能な範囲で自動的に修正（例: リンク表記の統一）
4. **ユーザー承認**: 分割やリネームなど、大きな変更が必要な場合は、ユーザー承認を得てから実行
```

## 結果（実施報告）

### 設定ファイルの変更内容

（ここに記録）

### 追加したチェック機能

（ここに記録）

### テスト結果

（ここに記録）

## 次のアクション

- 設定ファイルの改定後、エージェントがルールを遵守することを確認
- 必要に応じて、チェック機能を追加実装

<!-- AUTO:project:start -->
- [[project_docs_refactor|project: docs_refactor]]
<!-- AUTO:project:end -->

